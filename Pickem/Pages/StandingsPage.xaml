<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="Pickem.Pages.StandingsPage" 
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui" 
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml" 
             xmlns:models="clr-namespace:Pickem.Models" 
             xmlns:behaviors="clr-namespace:Pickem.Behaviors" 
             Title="Standings">

  <ContentPage.Behaviors>
    <behaviors:UserChipBehavior />
  </ContentPage.Behaviors>

  <ContentPage.Resources>
    <ResourceDictionary>
      <Color x:Key="ZebraOdd">#FFF9C4</Color>
      <Color x:Key="ZebraEven">#E0F2F1</Color>
    </ResourceDictionary>
  </ContentPage.Resources>

  <!-- Four rows:
       0) week controls
       1) page subheader (TB Actual)
       2) purple column header (outside list to avoid iOS clipping)
       3) list -->
  <Grid Padding="16,0" RowSpacing="0" RowDefinitions="Auto,Auto,Auto,*">

    <!-- Row 0: Week controls -->
    <Grid Grid.Row="0" ColumnDefinitions="50,Auto,Auto,50,*,Auto,Auto" ColumnSpacing="8">
      <Button Grid.Column="0" Text="◀" Clicked="OnPrevWeek" />
      <Label Grid.Column="1" Text="Week" VerticalOptions="Center" />
      <Label x:Name="WeekLabel" Grid.Column="2" Text="1" FontAttributes="Bold" VerticalOptions="Center" />
      <Button Grid.Column="3" Text="▶" Clicked="OnNextWeek" />
      <Label Grid.Column="4" />
      <Button Grid.Column="6" Text="Reload" Clicked="OnReload" />
      <ActivityIndicator Grid.Column="5" x:Name="Busy" IsRunning="False" IsVisible="False" VerticalOptions="Center" />
    </Grid>

    <!-- Row 1: Page subheader -->
    <Label Grid.Row="1" x:Name="TieBreakActualLabel" FontAttributes="Bold" Text="TB Actual" HorizontalTextAlignment="Center" Margin="0,6,0,4" />

    <!-- Row 2: Purple column header OUTSIDE the CollectionView -->
    <Border Grid.Row="2" Stroke="Transparent" Background="Purple" StrokeShape="RoundRectangle 10" Margin="0,0,0,2">
      <Grid ColumnDefinitions="*,55,50,50,40" Padding="12,0" HeightRequest="30">
        <Label Grid.Column="0" Text="Player" TextColor="White" FontAttributes="Bold" VerticalTextAlignment="Center" />
        <Label Grid.Column="1" Text="Points" TextColor="White" FontAttributes="Bold" VerticalTextAlignment="Center" HorizontalTextAlignment="Center" />
        <Label Grid.Column="2" Text="✓" TextColor="White" FontAttributes="Bold" VerticalTextAlignment="Center" HorizontalTextAlignment="Center" />
        <Label Grid.Column="3" Text="TB" TextColor="White" FontAttributes="Bold" VerticalTextAlignment="Center" HorizontalTextAlignment="Center" />
        <Label Grid.Column="4" Text="Δ" TextColor="White" FontAttributes="Bold" VerticalTextAlignment="Center" HorizontalTextAlignment="Center" />
      </Grid>
    </Border>

    <!-- Row 3: The list (NO Header inside) -->
    <CollectionView Grid.Row="3" x:Name="RowsList" ItemsLayout="VerticalList" Margin="0">
      <CollectionView.ItemTemplate>
        <DataTemplate x:DataType="models:StandingRow">
          <!-- Outer row container with zebra background -->
          <Grid RowDefinitions="Auto" BackgroundColor="{StaticResource ZebraOdd}">
            <Grid.Triggers>
              <DataTrigger TargetType="Grid" Binding="{Binding IsAlternate}" Value="True">
                <Setter Property="BackgroundColor" Value="{StaticResource ZebraEven}" />
              </DataTrigger>
            </Grid.Triggers>

            <!-- Content aligned with header columns -->
            <Grid Padding="12,0" ColumnDefinitions="*,55,50,50,40" HeightRequest="25">
              <Label Grid.Column="0" Text="{Binding PlayerName}" VerticalTextAlignment="Center" LineBreakMode="TailTruncation" />
              <Label Grid.Column="1" Text="{Binding TotalPoints}" VerticalTextAlignment="Center" HorizontalTextAlignment="Center" />
              <Label Grid.Column="2" Text="{Binding CorrectCount}" VerticalTextAlignment="Center" HorizontalTextAlignment="Center" />
              <Label Grid.Column="3" Text="{Binding TieBreakGuess, TargetNullValue='-'}" VerticalTextAlignment="Center" HorizontalTextAlignment="Center" />
              <Label Grid.Column="4" Text="{Binding TieBreakDiff, TargetNullValue='-'}" VerticalTextAlignment="Center" HorizontalTextAlignment="Center" />
            </Grid>

            <!-- Divider -->
            <BoxView HeightRequest="1" BackgroundColor="Black" Opacity="0.25" VerticalOptions="End" InputTransparent="True" />
          </Grid>
        </DataTemplate>
      </CollectionView.ItemTemplate>
    </CollectionView>

  </Grid>
</ContentPage>
